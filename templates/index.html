<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project_name }} - BIM porqueViven</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f8fafc; color: #1e293b; }
        header { background: #fff; border-bottom: 1px solid #e2e8f0; padding: 16px 24px; }
        header h1 { font-size: 20px; }
        header p { font-size: 13px; color: #64748b; margin-top: 4px; }
        main { max-width: 960px; margin: 0 auto; padding: 24px 16px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px; }
        .stat { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s; }
        .stat:hover { border-color: #2563eb; }
        .stat.active { border-color: #2563eb; box-shadow: 0 0 0 2px rgba(37,99,235,0.2); }
        .stat-num { font-size: 28px; font-weight: 700; color: #2563eb; }
        .stat-label { font-size: 12px; color: #64748b; margin-top: 4px; }

        .toolbar { display: flex; gap: 12px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 200px; padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: #fff; }
        .search-box:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 2px rgba(37,99,235,0.2); }
        .count-label { font-size: 13px; color: #64748b; white-space: nowrap; }

        h2 { font-size: 16px; margin-bottom: 12px; }
        .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: 8px; border: 1px solid #e2e8f0; }
        table { width: 100%; background: #fff; border-collapse: collapse; font-size: 13px; }
        th { background: #f8fafc; text-align: left; padding: 10px 12px; font-weight: 600; color: #475569; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; }
        td { padding: 8px 12px; border-bottom: 1px solid #f1f5f9; }
        tr:nth-child(even) td { background: #fafbfc; }
        tr:hover td { background: #f1f5f9; }
        tr.hidden { display: none; }
        a { color: #2563eb; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <header>
        <h1>{{ project_name }}</h1>
        <p>porqueViven BIM &mdash; {{ elements | length }} elementos</p>
    </header>
    <main>
        <div class="stats" id="stats">
            <div class="stat active" data-disc="all">
                <div class="stat-num">{{ elements | length }}</div>
                <div class="stat-label">Todos</div>
            </div>
            {% for disc, count in discipline_counts.items() %}
            <div class="stat" data-disc="{{ disc }}">
                <div class="stat-num">{{ count }}</div>
                <div class="stat-label">{{ disc }}</div>
            </div>
            {% endfor %}
        </div>

        <h2>Elementos</h2>
        <div class="toolbar">
            <input type="search" class="search-box" id="search" placeholder="Buscar por marca, nombre o categoria..." autocomplete="off">
            <span class="count-label" id="count">{{ elements | length }} de {{ elements | length }}</span>
        </div>

        <div class="table-wrap">
            <table>
                <thead>
                    <tr><th>Marca</th><th>Nombre</th><th>Disciplina</th><th>Categoria</th></tr>
                </thead>
                <tbody id="tbody">
                    {% for el in elements %}
                    <tr data-disc="{{ el.discipline }}">
                        <td><a href="e/{{ el.marca }}/">{{ el.marca }}</a></td>
                        <td>{{ el.name }}</td>
                        <td>{{ el.discipline }}</td>
                        <td>{{ el.category or '' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <script>
    (function() {
        var search = document.getElementById('search');
        var tbody = document.getElementById('tbody');
        var count = document.getElementById('count');
        var stats = document.getElementById('stats');
        var rows = Array.from(tbody.querySelectorAll('tr'));
        var total = rows.length;
        var activeDisc = 'all';

        function filter() {
            var q = search.value.toLowerCase();
            var visible = 0;
            rows.forEach(function(row) {
                var disc = row.getAttribute('data-disc');
                var matchDisc = activeDisc === 'all' || disc === activeDisc;
                var text = row.textContent.toLowerCase();
                var matchText = !q || text.indexOf(q) !== -1;
                if (matchDisc && matchText) {
                    row.classList.remove('hidden');
                    visible++;
                } else {
                    row.classList.add('hidden');
                }
            });
            count.textContent = visible + ' de ' + total;
        }

        search.addEventListener('input', filter);

        stats.addEventListener('click', function(e) {
            var stat = e.target.closest('.stat');
            if (!stat) return;
            stats.querySelectorAll('.stat').forEach(function(s) { s.classList.remove('active'); });
            stat.classList.add('active');
            activeDisc = stat.getAttribute('data-disc');
            filter();
        });
    })();
    </script>
</body>
</html>
